<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Control Panel | 1 MG Trader</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, doc, updateDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSy...", // Apna sahi API Key yahan dalen
            authDomain: "mg-trader.firebaseapp.com",
            projectId: "mg-trader",
            storageBucket: "mg-trader.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Tabs Logic ---
        window.openTab = (tabName, event) => {
            let contents = document.getElementsByClassName("content-section");
            for (let s of contents) s.style.display = "none";
            
            let buttons = document.getElementsByClassName("tab-btn");
            for (let b of buttons) b.classList.remove("active");

            document.getElementById(tabName).style.display = "block";
            event.currentTarget.classList.add("active");
        };

        // --- Firebase Data Listeners ---
        function initAdminSync() {
            // 1. Orders Sync
            const qOrders = query(collection(db, "orders"), where("status", "==", "Pending"), orderBy("timestamp", "desc"));
            onSnapshot(qOrders, (snap) => {
                const body = document.getElementById('orderBody');
                body.innerHTML = snap.empty ? "<tr><td colspan='3' style='text-align:center;'>No pending orders.</td></tr>" : "";
                snap.forEach(d => {
                    const o = d.data();
                    body.innerHTML += `<tr><td><b>${o.shop}</b></td><td>Rs. ${o.total}</td><td><button class="btn-ok" onclick="approveOrder('${d.id}')">Delivered</button></td></tr>`;
                });
            });

            // 2. Workers Sync (User Registrations)
            onSnapshot(collection(db, "users"), (snap) => {
                const body = document.getElementById('workerBody');
                body.innerHTML = "";
                snap.forEach(d => {
                    const u = d.data();
                    body.innerHTML += `<tr><td>${u.name}</td><td>${u.role}</td><td><span style="color:${u.status==='Active'?'green':'red'}">${u.status}</span></td></tr>`;
                });
            });
        }

        window.approveOrder = async (id) => {
            await updateDoc(doc(db, "orders", id), { status: "Delivered" });
            alert("Order Approved!");
        };

        window.onload = initAdminSync;
    </script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding-bottom: 120px; }
        .admin-header { background: #2c3e50; color: white; padding: 20px; text-align: center; }
        .nav-bar { background: #34495e; padding: 10px; text-align: center; }
        .nav-bar a { color: white; text-decoration: none; margin: 0 15px; font-weight: bold; }
        
        .container { max-width: 1100px; margin: 20px auto; padding: 0 20px; }
        
        .tab-wrapper { display: flex; background: #ddd; border-radius: 8px 8px 0 0; overflow: hidden; }
        .tab-btn { flex: 1; padding: 15px; border: none; cursor: pointer; font-weight: bold; background: #ddd; }
        .tab-btn.active { background: white; color: #2c3e50; border-top: 3px solid #f39c12; }

        .content-area { background: white; padding: 20px; border-radius: 0 0 8px 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); min-height: 300px; }
        .content-section { display: none; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .btn-ok { background: #27ae60; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; }

        /* Footer */
        footer { position: fixed; bottom: 0; left: 0; width: 100%; background: #2c3e50; color: white; border-top: 3px solid #3498db; }
        .footer-main { display: flex; justify-content: space-around; align-items: center; padding: 8px 20px; font-size: 12px; }
        .dev-name { color: #f1c40f; font-weight: bold; }
        .footer-ticker { background: #1a252f; padding: 4px 0; overflow: hidden; }
        .ticker-text { display: inline-block; padding-left: 100%; animation: marquee 25s linear infinite; font-size: 11px; white-space: nowrap; color: #bdc3c7; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body>

<div class="admin-header"><h1>1 MG TRADER | ADMIN CONTROL</h1></div>
<div class="nav-bar">
    <a href="index.html">DASHBOARD</a>
    <a href="inventory.html">INVENTORY</a>
    <a href="#" onclick="sessionStorage.clear(); window.location.href='login.html'">LOGOUT</a>
</div>

<div class="container">
    <div class="tab-wrapper">
        <button class="tab-btn active" onclick="openTab('orders', event)">üì¶ Orders</button>
        <button class="tab-btn" onclick="openTab('workers', event)">üë• Workers</button>
        <button class="tab-btn" onclick="openTab('requests', event)">üì© Requests</button>
        <button class="tab-btn" onclick="openTab('alerts', event)">‚ö†Ô∏è Alerts</button>
        <button class="tab-btn" onclick="openTab('passwords', event)">üîí Passwords</button>
    </div>

    <div class="content-area">
        <div id="orders" class="content-section" style="display: block;">
            <h3>Pending Orders Approval</h3>
            <table>
                <thead><tr><th>Shop</th><th>Amount</th><th>Action</th></tr></thead>
                <tbody id="orderBody"><tr><td colspan="3" style="text-align:center;">Loading orders...</td></tr></tbody>
            </table>
        </div>

        <div id="workers" class="content-section">
            <h3>Registered Staff Members</h3>
            <table>
                <thead><tr><th>Name</th><th>Role</th><th>Status</th></tr></thead>
                <tbody id="workerBody"></tbody>
            </table>
        </div>

        <div id="requests" class="content-section"><h3>üì© Registration Requests</h3><p>Coming Soon...</p></div>
        <div id="alerts" class="content-section"><h3>‚ö†Ô∏è System Alerts</h3><p>No new alerts.</p></div>
        <div id="passwords" class="content-section"><h3>üîí Password Management</h3><p>Admin only access.</p></div>
    </div>
</div>

<footer>
    <div class="footer-main">
        <div><span style="color:#2ecc71;">‚óè ONLINE</span> STATUS</div>
        <div><strong>1 MG TRADER</strong> | ADMIN</div>
        <div>DESIGNED BY: <span class="dev-name">MALIK FAISAL</span></div>
    </div>
    <div class="footer-ticker">
        <div class="ticker-text">Authorized Access Only | Secure Cloud v5.0 | Managed by Malik Faisal | All Rights Reserved 2026 ¬©</div>
    </div>
</footer>

</body>
</html>