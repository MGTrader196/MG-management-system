<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1 MG Trader | Professional Worker System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding-bottom: 100px; }
        .worker-layout { display: flex; flex-direction: column; padding: 20px; gap: 20px; }
        
        /* Layout/Stats Styles from Original */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; border-bottom: 4px solid #2980b9; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 5px; color: #34495e; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-add { background: #27ae60; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* --- NEW PROFESSIONAL ID CARD STYLE --- */
        .cards-container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
        .id-card-wrapper { position: relative; }
        
        .id-card { 
            width: 325px; height: 200px; background: white; border-radius: 10px; 
            display: flex; border: 1px solid #ccc; box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
            overflow: hidden; background: linear-gradient(135deg, #ffffff 60%, #f8f9fa 100%);
        }
        .card-left { 
            width: 35%; background: #2c3e50; color: white; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; padding: 10px; text-align: center;
        }
        .card-right { width: 65%; padding: 15px; position: relative; display: flex; flex-direction: column; }
        .worker-img { width: 75px; height: 75px; border-radius: 5px; border: 2px solid white; object-fit: cover; margin-bottom: 5px; }
        .card-title { font-size: 14px; font-weight: bold; color: #2980b9; border-bottom: 2px solid #2980b9; margin-bottom: 8px; padding-bottom: 2px; }
        .worker-name { font-size: 16px; font-weight: 800; color: #333; margin: 2px 0; }
        .worker-detail { font-size: 11px; color: #555; line-height: 1.4; }
        .qr-zone { position: absolute; bottom: 10px; right: 10px; border: 1px solid #eee; padding: 2px; background: white; }
        
        .btn-print-small { 
            position: absolute; top: -10px; right: -10px; background: #3498db; 
            color: white; border: none; border-radius: 50%; width: 30px; height: 30px; 
            cursor: pointer; z-index: 5; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Print Settings */
        @media print {
            body * { visibility: hidden; }
            .id-card, .id-card * { visibility: visible; }
            .id-card { position: fixed; left: 0; top: 0; border: none; box-shadow: none; }
            .btn-print-small, .no-print { display: none !important; }
        }
    </style>
</head>
<body>

<header class="main-header no-print" style="background: #2c3e50; color: white; padding: 15px; text-align: center;">
    <h2 style="margin: 0;">üì¶ 1 MG TRADER</h2>
    <nav style="margin-top: 10px;">
        <a href="index.html" style="color: white; text-decoration: none; margin: 0 15px; font-weight: bold;">üè† Dashboard</a>
        <a href="workers.html" style="color: white; text-decoration: none; margin: 0 15px; font-weight: bold;">üë• Workers</a>
    </nav>
</header>

<div class="worker-layout no-print">
    <div class="stats-grid">
        <div class="stat-card"><span>Total Employees</span><h2 id="totalW">0</h2></div>
        <div class="stat-card" style="border-color: #27ae60;"><span>Monthly Budget</span><h2 id="totalS">Rs. 0</h2></div>
    </div>

    <div class="card">
        <h3>‚ûï Add New Worker</h3>
        <div class="form-grid">
            <div><label>Full Name</label><input type="text" id="wName"></div>
            <div><label>Designation</label><input type="text" id="wRole"></div>
            <div><label>Phone #</label><input type="text" id="wPhone"></div>
            <div><label>Salary</label><input type="number" id="wSalary"></div>
            <div><label>Blood Group</label><input type="text" id="wBlood" placeholder="e.g. B+"></div>
            <div><label>Address</label><input type="text" id="wAddress"></div>
            <div><label>Photo</label><input type="file" id="wPhoto" accept="image/*"></div>
        </div>
        <button class="btn-add" onclick="saveWorker()">‚úÖ Send for Approval</button>
    </div>
</div>

<div class="worker-layout">
    <h3>üé¥ Digital ID Cards (Click üñ®Ô∏è to print)</h3>
    <div class="cards-container" id="cardsGallery"></div>
</div>

<script>
    let workers = JSON.parse(localStorage.getItem('mg_final_workers')) || [];

    function saveWorker() {
        const fileInput = document.getElementById('wPhoto');
        const reader = new FileReader();

        reader.onloadend = function() {
            let pendingRequest = {
                id: Date.now(),
                name: document.getElementById('wName').value,
                role: document.getElementById('wRole').value,
                phone: document.getElementById('wPhone').value,
                salary: parseFloat(document.getElementById('wSalary').value) || 0,
                blood: document.getElementById('wBlood').value,
                address: document.getElementById('wAddress').value,
                photo: reader.result || '',
                type: 'New User'
            };

            if(pendingRequest.name && pendingRequest.phone) {
                let pending = JSON.parse(localStorage.getItem('pendingUsers')) || [];
                pending.push(pendingRequest);
                localStorage.setItem('pendingUsers', JSON.stringify(pending));
                alert("‚úÖ Request Sent to Admin!");
                clearForm();
            } else { alert("Name and Phone are required!"); }
        }

        if (fileInput.files[0]) { reader.readAsDataURL(fileInput.files[0]); } 
        else { reader.onloadend(); }
    }

    function printCard(id) {
        window.print();
    }

    function updateUI() {
        let cardContainer = document.getElementById('cardsGallery');
        cardContainer.innerHTML = "";
        let totalSal = 0;

        workers.forEach(w => {
            totalSal += w.salary;
            let qrId = `qr-${w.id}`;
            // workers.html ke updateUI function mein card template ye rakhein:

cardContainer.innerHTML += `
    <div class="id-card-wrapper">
        <button class="btn-print-small no-print" onclick="printCard(${w.id})">üñ®Ô∏è</button>
        <div class="id-card" id="card-${w.id}">
            <div class="card-left">
                <img src="${w.photo || 'https://via.placeholder.com/70'}" class="worker-img">
                <div style="font-size:10px; margin-top:5px; font-weight:bold;">${w.workerId}</div>
                <div style="font-size:9px; background:${w.status === 'Inactive' ? '#e74c3c' : '#27ae60'}; padding:2px 5px; border-radius:3px; margin-top:3px;">
                    ${w.status || 'Active'}
                </div>
            </div>
            <div class="card-right">
                <div class="card-title">1 MG TRADER</div>
                <div class="worker-name">${w.name}</div>
                <div class="worker-detail"><b>Role:</b> ${w.role}</div>
                <div class="worker-detail"><b>Blood:</b> ${w.blood} | <b>Ph:</b> ${w.phone}</div>
                <div class="worker-detail"><b>Address:</b> ${w.address}</div>
                <div class="qr-zone" id="${qrId}"></div>
            </div>
        </div>
    </div>
`;

            setTimeout(() => {
                new QRCode(document.getElementById(qrId), { text: w.workerId, width: 45, height: 45 });
            }, 100);
        });

        document.getElementById('totalW').innerText = workers.length;
        document.getElementById('totalS').innerText = "Rs. " + totalSal.toLocaleString();
    }

    function clearForm() {
        document.getElementById('wName').value = '';
        document.getElementById('wRole').value = '';
        document.getElementById('wPhone').value = '';
        document.getElementById('wSalary').value = '';
        document.getElementById('wBlood').value = '';
        document.getElementById('wAddress').value = '';
        document.getElementById('wPhoto').value = '';
    }

    updateUI();
</script>
  <footer style="position: fixed; bottom: 0; left: 0; width: 100%; background: #2c3e50; color: white; padding: 10px 0; overflow: hidden; z-index: 100;">
    <div class="ticker-text" style="display: inline-block; white-space: nowrap; animation: marquee 20s linear infinite;">
        Offline Local System | 1 MG Trader | Managed by Management System | All Rights Reserved 2024-25
    </div>
</footer>

<style>
@keyframes marquee {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
}
</style>

</body>
</html>