<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1 MG Trader | Smart Stock Management (Cloud)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding-bottom: 60px; }
        .main-header { background: #2c3e50; color: white; padding: 15px; text-align: center; }
        .nav-bar { background: #34495e; padding: 10px; text-align: center; }
        .nav-bar a { color: white; text-decoration: none; margin: 0 15px; font-weight: bold; }
        .container { padding: 20px; max-width: 1400px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid-5 { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        label { font-size: 11px; font-weight: bold; color: #3498db; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-top: 5px; box-sizing: border-box; }
        button { cursor: pointer; border: none; font-weight: bold; border-radius: 6px; transition: 0.3s; }
        .btn-save { background: #27ae60; color: white; width: 100%; padding: 15px; font-size: 16px; margin-top: 15px; }
        .btn-save:hover { background: #219150; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #2c3e50; color: white; }
        .low-stock { background: #ff7675 !important; color: white; }
        .ticker { position: fixed; bottom: 0; width: 100%; background: #2c3e50; color: white; padding: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="main-header">
    <h1>1 MG TRADER | STOCK MANAGEMENT</h1>
</div>

<div class="nav-bar">
    <a href="index.html">üè† Dashboard</a>
    <a href="sales.html">üßæ Sales</a>
    <a href="customers.html">üë§ Customers</a>
    <a href="expenses.html">üí∏ Expenses</a>
</div>

<div class="container">
    <div class="card">
        <h3>‚ûï Add New Stock</h3>
        <div class="grid-5">
            <div><label>Product Name</label><input type="text" id="pName" placeholder="Mobile, Charger etc."></div>
            <div><label>Company</label><input type="text" id="pComp" placeholder="Samsung, Apple"></div>
            <div><label>Category</label><input type="text" id="pCat" placeholder="Accessories"></div>
            <div><label>Purchase Price</label><input type="number" id="pCost" placeholder="0"></div>
            <div><label>Sale Price</label><input type="number" id="pPrice" placeholder="0"></div>
            <div><label>Current Stock (Qty)</label><input type="number" id="pQty" placeholder="0"></div>
            <div><label>Min. Alert Level</label><input type="number" id="pMin" value="5"></div>
            <div><label>Expiry Date</label><input type="date" id="pExp"></div>
        </div>
        <button class="btn-save" id="btnSave">üöÄ SAVE PRODUCT TO CLOUD</button>
    </div>

    <div class="card">
        <input type="text" id="pSearch" onkeyup="searchProduct()" placeholder="üîç Search Stock by Name or Company..." style="margin-bottom:15px; padding: 12px;">
        <table>
            <thead>
                <tr>
                    <th>Product Details</th>
                    <th>Purchase</th>
                    <th>Sale</th>
                    <th>Stock</th>
                    <th>Expiry</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="productBody">
                </tbody>
        </table>
    </div>
</div>

<div class="ticker" id="tickerText">Connecting to Cloud...</div>

<script type="module">
    // Firebase Setup
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD3So-in02rbcWD7OmuiRXzySQYgCR7iVI",
        authDomain: "mg-tradere.firebaseapp.com",
        projectId: "mg-tradere",
        storageBucket: "mg-tradere.firebasestorage.app",
        messagingSenderId: "318790809953",
        appId: "1:318790809953:web:5e829277f6d161e9942d20"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const stockCol = collection(db, "products");

    // 1. Data Save Karna (Cloud)
    document.getElementById('btnSave').onclick = async function() {
        const product = {
            name: document.getElementById('pName').value.trim(),
            company: document.getElementById('pComp').value.trim(),
            category: document.getElementById('pCat').value.trim(),
            cost: Number(document.getElementById('pCost').value),
            price: Number(document.getElementById('pPrice').value),
            qty: Number(document.getElementById('pQty').value),
            min: Number(document.getElementById('pMin').value),
            expiry: document.getElementById('pExp').value,
            time: new Date().toLocaleString()
        };

        if(!product.name || !product.qty) return alert("Product Name aur Qty lazmi hai!");

        try {
            await addDoc(stockCol, product);
            alert("‚úÖ Stock Cloud Par Save Ho Gaya!");
            document.querySelectorAll('input').forEach(i => i.value = "");
        } catch (e) {
            alert("‚ùå Cloud Error: " + e.message);
        }
    };

    // 2. Data Load Karna (Live - Refresh ki zaroorat nahi)
    onSnapshot(stockCol, (snapshot) => {
        let html = "";
        let lowItems = 0;
        
        snapshot.forEach((docSnap) => {
            const p = docSnap.data();
            const id = docSnap.id;
            const isLow = p.qty <= p.min;
            if(isLow) lowItems++;

            html += `
                <tr class="${isLow ? 'low-stock' : ''}">
                    <td><b>${p.name}</b><br><small>${p.company} | ${p.category}</small></td>
                    <td>Rs. ${p.cost}</td>
                    <td>Rs. ${p.price}</td>
                    <td><b>${p.qty}</b></td>
                    <td>${p.expiry || 'No Expiry'}</td>
                    <td>
                        <button onclick="deleteMe('${id}')" style="background:#e74c3c; color:white; padding:5px 10px; border-radius:4px;">üóëÔ∏è</button>
                    </td>
                </tr>
            `;
        });
        document.getElementById('productBody').innerHTML = html || '<tr><td colspan="6">No Stock Found in Cloud</td></tr>';
        document.getElementById('tickerText').innerText = `‚ö†Ô∏è ALERT: ${lowItems} Items Low Stock | Cloud Database Live üü¢`;
    });

    // 3. Delete Function
    window.deleteMe = async function(id) {
        if(confirm("Kya aap waqai ye product delete karna chahte hain?")) {
            await deleteDoc(doc(db, "products", id));
        }
    };

    // Search function (Local)
    window.searchProduct = function() {
        let val = document.getElementById('pSearch').value.toUpperCase();
        let rows = document.getElementById('productBody').getElementsByTagName('tr');
        for (let i = 0; i < rows.length; i++) {
            rows[i].style.display = rows[i].innerText.toUpperCase().includes(val) ? "" : "none";
        }
    }
</script>

</body>
</html>